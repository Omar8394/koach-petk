{% extends "layouts/base.html" %}

{% block title %} Cambiar Pregunta {% endblock %} 

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}{% endblock stylesheets %}

{% block content %}

<div class="content">
    <div class="page-inner animated fadeInRight">
        <div class="page-header">
            <h4 class="page-title">Cambiar Pregunta Secreta</h4>
            <ul class="breadcrumbs">
                <li class="nav-home">
                    <a href="{% url 'home' %}">
                        <i class="flaticon-home"></i>
                    </a>
                </li>
                <li class="separator">
                    <i class="flaticon-right-arrow"></i>
                </li>
                <li class="nav-item">
                    <span>Cambiar Pregunta Secreta</span>
                </li>             
            </ul>
        </div>
        <div class="page-category">
 <div class="col-md-12 d-flex justify-content-center text-center">
        <div class="card" style="width: 30rem;">
            <div class="card-header bg-dark2">
                <div class="card-title">

                    {% if msg %}
                        <span class="text-danger">{{ msg | safe }}</span>
                    {% else %}
                    <span style="color: white">
                        {% block titulo %}Pregunta Secreta de su Cuenta{% endblock %}
                    </span>
                    {% endif %}

                </div>
            </div>

            <form method="post" id="change_question">

                {% csrf_token %}

                <div class="card-body">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">
                                            <i class="icon-question"></i>
                                        </span>
                                    </div>
                                    <select id="cb_tipo_pregunta" name="cb_tipo_pregunta" class="form-control">
                                 {% if preguntas is not None %}
                                     {% for pregunta in preguntas %}
                                         {% if pregunta.id_tabla == pregunta_id %}
                                        <option value="{{ pregunta.id_tabla }}" selected>{{ pregunta.desc_elemento }}</option>
                                             {% else %}
                                             <option value="{{ pregunta.id_tabla }}">{{ pregunta.desc_elemento }}</option>
                                         {% endif %}
                                     {% endfor %}
                                {% endif %}
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">
                                            <i class="icon-pencil"></i>
                                        </span>
                                    </div>
                                        <input name="respuesta" id="respuesta" type="password" class="form-control" placeholder="Respuesta Secreta" autocomplete="new-password" value="{% if respuesta is not None %}{{ respuesta }}{% endif %}" required>
                                 <div class="input-group-prepend">
                                        <button type="button" id="ver_respuesta" class="btn btn-secondary">
                                            <i class="icon-eye"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        <div class="form-group">
                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">
                                            <i class="icon-lock"></i>
                                        </span>
                                    </div>
                                        <input name="password" id="passwordactual" type="password" class="form-control" placeholder="ContraseÃ±a Actual" autocomplete="new-password" required>
                                <div class="input-group-prepend">
                                        <button type="button" id="ver_clave" class="btn btn-secondary">
                                            <i class="icon-eye"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-action">
                    <button type="submit" class="btn bg-dark2 btn-lg btn-block" style="color: white">Guardar</button>
                </div>
            </form>
        </div>
    </div>
        </div>
    </div>
</div>




{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}
<script>
$('#ver_respuesta').click(function () {
mostrar_clave("respuesta")
});
$('#ver_clave').click(function () {
mostrar_clave("passwordactual")
});
function mostrar_clave(selector){
    if ($('#'+selector).attr('type') === 'password') {
        $('#'+selector).attr('type', 'text');
    } else {
        $('#'+selector).attr('type', 'password');
    }
}
$('#change_question').on('submit',function () {
    let formdata = new FormData(this);

$.ajax({
                    type: "POST",
                    url: "{% url 'security:changeSecretQuestion' %}",
                    data : formdata,
                    processData:false,
                    contentType:false,
                success: function (response) {
                        alertaMensajitos(response.tipo,response.titulo,response.mensaje)
                        $('#passwordactual').val('');
                        $('#respuesta').attr('type', 'password');

                },
                error: function (e) {
                    alertaMensajitos(5,"An error has occurred","error when changing secret question:"+e)
                }
            });
            return false;
})

</script>
{% endblock javascripts %}